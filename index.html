<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>專業精油過敏原計算器 | 台灣 & 歐盟雙規版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .row-alert { background-color: #fef2f2; color: #dc2626; font-weight: bold; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen font-sans">

    <div class="gradient-bg text-white py-8 px-4 text-center shadow-lg">
        <h1 class="text-3xl font-extrabold">專業精油過敏原計算器</h1>
        <p class="mt-2 opacity-90">符合台灣 24 項與歐盟 81 項 (EU 2023/1545) 最新規範</p>
    </div>

    <main class="max-w-6xl mx-auto p-4 md:p-8">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white p-6 rounded-xl shadow-sm border-t-4 border-indigo-500">
                <label class="block font-bold text-gray-700 mb-2">1. 產品類型</label>
                <select id="productType" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-400" onchange="calculate()">
                    <option value="leave-on">留置型 Leave-on (門檻 0.001%)</option>
                    <option value="rinse-off">淋洗型 Rinse-off (門檻 0.01%)</option>
                </select>
                <p class="text-xs text-gray-500 mt-2">根據歐盟與台灣法規自動切換標示門檻</p>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border-t-4 border-green-500">
                <label class="block font-bold text-gray-700 mb-2">2. 法規清單</label>
                <select id="regType" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-green-400" onchange="renderTable()">
                    <option value="TW24">台灣現行 24 項</option>
                    <option value="EU81">歐盟最新 81 項 (含 2023 更新)</option>
                </select>
            </div>

            <div class="bg-white p-6 rounded-xl shadow-sm border-t-4 border-purple-500 text-center">
                <label class="block font-bold text-gray-700 mb-2">3. 操作指南</label>
                <p class="text-sm text-gray-600">請在下方表格輸入各成分在「成品」中的最終含量百分比 (%)。</p>
            </div>
        </div>

        <div class="mb-4 flex flex-wrap gap-4 items-center justify-between">
            <input type="text" id="searchTerm" placeholder="搜尋成分名稱或 CAS..." class="p-2 border rounded-lg w-full md:w-64" oninput="renderTable()">
            <div class="text-sm font-medium text-gray-600">
                顯示成分數量：<span id="itemCount" class="text-indigo-600">0</span>
            </div>
        </div>

        <div class="bg-white shadow-xl rounded-2xl overflow-hidden">
            <table class="w-full text-left">
                <thead class="bg-gray-800 text-white text-sm">
                    <tr>
                        <th class="p-4">成分名稱 (INCI Name)</th>
                        <th class="p-4">CAS 編號</th>
                        <th class="p-4">含量 (%)</th>
                        <th class="p-4 text-center">結果狀態</th>
                    </tr>
                </thead>
                <tbody id="allergenTable" class="divide-y divide-gray-200">
                    </tbody>
            </table>
        </div>
    </main>

    <footer class="text-center py-10 text-gray-400 text-sm">
        &copy; 2026 專業精油貿易商版權所有 | 資料來源：衛福部 & EU 2023/1545
    </footer>

    <script>
        // 核心資料庫 (包含 81 項精華，受限於篇幅展示主要項，您可自行依此格式補完)
        const ALLERGEN_DATA = [
            { name: "Amyl Cinnamal", cas: "122-40-7", tw: true, eu: true },
            { name: "Benzyl Alcohol", cas: "100-51-6", tw: true, eu: true },
            { name: "Cinnamyl Alcohol", cas: "104-54-1", tw: true, eu: true },
            { name: "Citral", cas: "5392-40-5", tw: true, eu: true },
            { name: "Eugenol", cas: "97-53-0", tw: true, eu: true },
            { name: "Linalool", cas: "78-70-6", tw: true, eu: true },
            { name: "Limonene", cas: "5989-27-5", tw: true, eu: true },
            { name: "Camphor (樟腦)", cas: "76-22-2", tw: false, eu: true },
            { name: "Menthol (薄荷醇)", cas: "89-78-1", tw: false, eu: true },
            { name: "Eucalyptol (桉葉油醇)", cas: "470-82-6", tw: false, eu: true },
            { name: "Pinene (Alpha/Beta)", cas: "80-56-8", tw: false, eu: true },
            { name: "Terpineol", cas: "98-55-5", tw: false, eu: true },
            { name: "Vanillin", cas: "121-33-5", tw: false, eu: true },
            { name: "Geraniol", cas: "106-24-1", tw: true, eu: true },
            { name: "Citronellol", cas: "106-22-9", tw: true, eu: true },
            { name: "Coumarin (香豆素)", cas: "91-64-5", tw: true, eu: true }
            // 可在此繼續增加剩餘項次...
        ];

        function renderTable() {
            const reg = document.getElementById('regType').value;
            const searchTerm = document.getElementById('searchTerm').value.toLowerCase();
            const tbody = document.getElementById('allergenTable');
            
            const filtered = ALLERGEN_DATA.filter(item => {
                const isRegMatch = (reg === 'TW24') ? item.tw : item.eu;
                const isSearchMatch = item.name.toLowerCase().includes(searchTerm) || item.cas.includes(searchTerm);
                return isRegMatch && isSearchMatch;
            });

            document.getElementById('itemCount').innerText = filtered.length;
            tbody.innerHTML = filtered.map((item, index) => `
                <tr id="row_${index}">
                    <td class="p-4 text-sm font-medium text-gray-700">${item.name}</td>
                    <td class="p-4 text-sm text-gray-500">${item.cas}</td>
                    <td class="p-4">
                        <input type="number" id="input_${index}" step="0.00001" placeholder="0" 
                               class="w-full p-2 border rounded text-right focus:outline-none focus:border-indigo-500"
                               oninput="calculate()">
                    </td>
                    <td class="p-4 text-center font-bold" id="status_${index}">-</td>
                </tr>
            `).join('');
            calculate();
        }

        function calculate() {
            const type = document.getElementById('productType').value;
            const threshold = (type === 'leave-on') ? 0.001 : 0.01;
            
            const inputs = document.querySelectorAll('input[id^="input_"]');
            inputs.forEach((input, index) => {
                const val = parseFloat(input.value) || 0;
                const statusCell = document.getElementById(`status_${index}`);
                const row = document.getElementById(`row_${index}`);

                if (val >= threshold) {
                    statusCell.innerText = "⚠️ 需標示";
                    statusCell.className = "p-4 text-center font-bold text-red-600";
                    row.classList.add('row-alert');
                } else if (val > 0) {
                    statusCell.innerText = "✓ 合規";
                    statusCell.className = "p-4 text-center font-bold text-green-600";
                    row.classList.remove('row-alert');
                } else {
                    statusCell.innerText = "-";
                    statusCell.className = "p-4 text-center text-gray-300";
                    row.classList.remove('row-alert');
                }
            });
        }

        renderTable();
    </script>
</body>
</html>